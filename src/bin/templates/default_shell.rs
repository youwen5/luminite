use hypertext::{GlobalAttributes, Renderable, Rendered, html_elements, maud};

use super::components::Head;

pub enum PageWidth {
    Wide,
    Prose,
}

/// The default "shell" around the page. Renders navigation, footer, and miscellany into place.
pub struct DefaultShell {
    pub head: Head,
    pub width: PageWidth,
}

impl DefaultShell {
    pub fn render_with_children(self, children: impl Renderable) -> Rendered<String> {
        let nav_items = maud! {
            li {a class="hover:bg-overlay transition-colors" href="/luminite" {"Luminite"}}
            li {a class="hover:bg-overlay transition-colors" href="/the-web-is-insane" {"The web is insane"}}
            li {a class="hover:bg-overlay transition-colors" href="/math-test" {"Math"}}
            li {a class="hover:bg-overlay transition-colors" href="/impressum" {"Impressum"}}
        };

        let page_width = match self.width {
            PageWidth::Wide => "",
            PageWidth::Prose => " lg:max-w-2xl",
        };

        maud! {
            !DOCTYPE
            html lang="en" {
                (self.head)
                body class="font-sans antialiased leading-relaxed mx-auto max-w-[1200px]" {
                    div class="flex gap-4 px-4 lg:px-6 lg:mt-20" {
                        aside class="hidden lg:block w-64 flex-none md:sticky lg:top-4 lg:max-h-screen lg:overflow-y-auto" {
                            a class="italic text-[3em] hover:bg-rose/50 transition-colors" href="/" {"youwen wu"}
                            nav class="space-y-4 text-2xl mt-4" {
                                ul class="space-y-2" {
                                    (nav_items)
                                }
                            }
                        }
                        main class=("main-content flex-1 lg:mt-2".to_owned() + page_width) {
                            div class="lg:hidden border-b border-dashed border-muted mb-4 space-y-4 pb-4"  {
                                p class="italic text-[3em] lg:text-start text-center" {"youwen wu"}
                                details class="w-full" {
                                    summary class="text-center smallcaps text-xl cursor-pointer" {
                                        "menu"
                                    }
                                    nav class="space-y-3 text-2xl" {
                                        ul class="space-y-4 text-xl" {
                                            (nav_items)
                                        }
                                    }
                                }
                            }
                            (children)
                            footer class="border-t border-solid border-muted mb-4 flex justify-between items-center gap-4 text-lg text-muted py-1 mt-24" {
                                p class="smallcaps" {"Â© 2025 Youwen Wu. Proudly generated by " a class="text-rose" style="text-decoration: none !important;" href="https://github.com/youwen5/luminite" {"luminite"}"."}
                            }
                        }
                    }
                }
            }
        }
        .render()
    }
}
